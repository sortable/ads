<html>
<head>
<script type="text/javascript" src="//www.googletagservices.com/tag/js/gpt.js" async></script>
<script type="text/javascript" src="//acdn.adnxs.com/prebid/not-for-prod/prebid.js" async></script>
<script type="text/javascript" src="//tag-cdn.deployads.com/example/example.com.js" async></script>
  
<script>
  var srtAdsManager = (function () { /** embeded Ad Manager library */ }());
</script>
  
<script>
// setting script

srtAdsManager.setBidderTimeout(1000);

function registerPrebid() {
  srtAdsManager.registerHB({
    name: 'prebid',
    onInit(cb) {
      window.pbjs = window.pbjs || {};
      pbjs.que = pbjs.que || [];
      pbjs.que.push(cb)
    },
    onDefineAd(divId) {
      if (divId === 'div-gpt-ad-1460505748561-0') {
        return {
          code: divId,
          sizes: [[300, 250], [300, 600]],
            bids: [{
            bidder: 'appnexus',
            params: {
              placementId: '10433394'
            }
          }]
        }
      } else if (divId === 'div-gpt-ad-1460505661639-0') {
        return {
          code: 'div-gpt-ad-1460505661639-0',
          sizes: [[728, 90], [970, 90]],
          bids: [{
            bidder: 'appnexus',
            params: {
              placementId: '10433394'
            }
          }]
        }
      }
    },
    onRequestAds(newUnits, refreshUnits, cb) {
      var adUnits = newUnits.concat(refreshUnits);
      pbjs.requestBids({
        adUnits:adUnits,
        timeout: srtAdsManager.getBidderTimeout(),
        bidsReadyHandler() {
          cb();
        }
      })
    },
    onSetTargetingForGPT(newUnits, refreshUnits) {
      var codes = newUnits.concat(refreshUnits).map(unit => unit.code);
      pbjs.setTargetingForGPTAsync(codes);
    }
  })
}

function registerSortable() {
  srtAdsManager.registerHB({
    name: 'sortable',
    onInit(cb) {
      window.deployads = window.deployads || [];
      deployads.push(cb);
    },
    onDefineAd(divId) {
      if (divId === 'div-gpt-ad-1460505748561-0') {
        return {
          code: divId,
          sizes: [[300, 250], [300, 600]]
        }
      } else if (divId === 'div-gpt-ad-1460505661639-0') {
        return {
          code: 'div-gpt-ad-1460505661639-0',
          sizes: [[728, 90], [970, 90]]
        }
      }
    },
    onRequestAds(newUnits, refreshUnits, cb) {
      var adUnits = newUnits.concat(refreshUnits);
      deployads.requestBids({
        adUnits:adUnits,
        timeout: srtAdsManager.getBidderTimeout(),
        bidsReadyHandler() {
          cb();
        }
      })
    },
    onSetTargetingForGPT(newUnits, refreshUnits) {
      deployads.setTargetingForGPTAsync(newUnits.concat(refreshUnits));
    }
  })
}

function registerGPT() {
  srtAdsManager.registerGPT({
    onInit(cb) {
      window.googletag = window.googletag || {};
      googletag.cmd = googletag.cmd || [];
      googeltag.cmd.push(() => {
        googletag.pubads().disableInitialLoad();
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
      });
    },
    onDefineAd(divId) {
      if (divId === 'div-gpt-ad-1460505748561-0') {
        return googletag.defineSlot('/19968336/header-bid-tag-0', [[300, 250], [300, 600]], divId).addService(googletag.pubads());
      } else if (divId === 'div-gpt-ad-1460505661639-0') {
        return googletag.defineSlot('/19968336/header-bid-tag1', [[728, 90], [970, 90]], divId).addService(googletag.pubads());
      }
    },
    onRequestAds(newSlots, refreshSlots, cb) {
      newSlots.forEach(slot => {
        googletag.display(slot.getSlotElementId());
      });
      googletag.pubads().refresh(newSlots.concat(refreshSlots));
      cb();
    }
  })
}

// ab test prebid and sortable
if (Math.random() > 0.5) {
  registerPrebid();
} else {
  registerSortable();
}
registerGPT();

</script>
</head>

<body>
<h2>Prebid.js Test</h2>
<h5>Div-1</h5>
<div id='div-gpt-ad-1460505748561-0'>
  <script type='text/javascript'>
    srtAdsManager.requestAds('div-gpt-ad-1460505748561-0');
  </script>
</div>

<h5>Div-2</h5>
<div id='div-gpt-ad-1460505661639-0'>
  <script type='text/javascript'>
    srtAdsManager.requestAds(['div-gpt-ad-1460505661639-0']);
  </script>
</div>

</body>
</html>
